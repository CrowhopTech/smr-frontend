{"version":3,"file":"edit.svelte-eea20693.js","sources":["../../../../../../../src/routes/mod/[modId]/edit.svelte"],"sourcesContent":["<script lang=\"ts\" context=\"module\">\n  import { paramsToProps } from '$lib/utils/routing';\n\n  export const load = paramsToProps();\n</script>\n\n<script lang=\"ts\">\n  import { mutation, operationStore, query } from '@urql/svelte';\n  import { EditModDocument, GetModDocument } from '$lib/generated';\n  import Toast from '$lib/components/general/Toast.svelte';\n  import { goto } from '$app/navigation';\n  import ModForm from '$lib/components/mods/ModForm.svelte';\n  import type { ModData } from '$lib/models/mods';\n  import { base } from '$app/paths';\n  import MetaDescriptors from '$lib/components/utils/MetaDescriptors.svelte';\n  import Card, { Content } from '@smui/card';\n  import { get } from 'svelte/store';\n\n  export let modId!: string;\n\n  let errorMessage = '';\n  let errorToast = false;\n\n  const mod = operationStore(GetModDocument, { mod: modId });\n\n  const editMod = mutation({\n    query: EditModDocument\n  });\n\n  const onSubmit = (data: ModData) => {\n    editMod({\n      modId: get(mod).data.mod.id,\n      mod: data\n    }).then((value) => {\n      if (value.error) {\n        console.error(value.error.message);\n        errorMessage = 'Error editing mod: ' + value.error.message;\n        errorToast = true;\n      } else {\n        // TODO Toast or something\n        goto(base + '/mod/' + value.data.updateMod.id);\n      }\n    });\n  };\n\n  $: if (!errorToast) errorMessage = '';\n\n  $: initialValues = $mod.data\n    ? {\n        ...$mod.data.mod,\n        logo: undefined\n      }\n    : undefined;\n\n  query(mod);\n</script>\n\n<svelte:head>\n  {#if !$mod.fetching && !$mod.error && $mod.data.mod}\n    <MetaDescriptors\n      description=\"Editing mod {$mod.data.mod.name}\"\n      title=\"Edit mod {$mod.data.mod.name}\"\n      image={$mod.data.mod.logo}\n    />\n  {/if}\n</svelte:head>\n\n<h1 class=\"text-4xl my-4 font-bold\">Edit Mod</h1>\n\n<Card>\n  <Content>\n    {#if $mod.fetching}\n      <p>Loading...</p>\n    {:else if $mod.error}\n      <p>Oh no... {$mod.error.message}</p>\n    {:else}\n      <ModForm {onSubmit} {initialValues} editing={true} submitText=\"Save\" />\n    {/if}\n  </Content>\n</Card>\n\n<Toast bind:running={errorToast}>\n  <span>{errorMessage}</span>\n</Toast>\n"],"names":["get"],"mappings":"uiCA4DgC,KAAK,KAAK,IAAI,uBACvB,KAAK,KAAK,IAAI,WACxB,KAAK,KAAK,IAAI,mIAFK,KAAK,KAAK,IAAI,gCACvB,KAAK,KAAK,IAAI,oBACxB,KAAK,KAAK,IAAI,wLAcwB,+PAFhC,KAAK,MAAM,qCAArB,yDAAA,2CAAH,2CAAa,KAAK,MAAM,2FAFrB,mDAAA,mCAAH,qHADG,MAAK,WAEA,KAAK,8pBASV,8CAAA,2BAAP,iCAAO,gEAxBD,KAAK,WAAa,KAAK,OAAS,KAAK,KAAK,+IAuB7B,2BAAA,+FAde,8MAAA,iMAApC,oEATQ,KAAK,WAAa,KAAK,OAAS,KAAK,KAAK,yOAuB7B,uNA9EN,IAAO,iCAeT,WAEP,EAAe,GACf,EAAa,QAEX,GAAM,EAAe,IAAkB,IAAK,4BAE5C,GAAU,GACd,MAAO,KAGH,EAAY,IAChB,GACE,MAAOA,GAAI,GAAK,KAAK,IAAI,GACzB,IAAK,IACJ,KAAM,IACH,EAAM,MACR,SAAQ,MAAM,EAAM,MAAM,aAC1B,EAAe,sBAAwB,EAAM,MAAM,aACnD,EAAa,KAGb,GAAK,GAAO,QAAU,EAAM,KAAK,UAAU,OAcjD,EAAM,iBA2Ba,0FApCX,QAAY,EAAe,uBAEhC,EAAgB,EAAK,SAEf,EAAK,KAAK,IACb,KAAM,QAER"}