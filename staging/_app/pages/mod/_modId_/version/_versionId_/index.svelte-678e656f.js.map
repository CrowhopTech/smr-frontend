{"version":3,"file":"index.svelte-678e656f.js","sources":["../../../../../../../../../src/lib/components/versions/VersionDescription.svelte","../../../../../../../../../src/lib/components/versions/VersionInfo.svelte","../../../../../../../../../src/routes/mod/[modId]/version/[versionId]/index.svelte"],"sourcesContent":["<script lang=\"ts\">\n  import { markdown } from '$lib/utils/markdown';\n  import Card, { Content } from '@smui/card';\n\n  export let changelog!: string;\n</script>\n\n<Card class=\"h-fit\">\n  <Content>\n    <div class=\"markdown-content\">\n      {#await markdown(changelog) then changelogRendered}\n        <p>{@html changelogRendered}</p>\n      {/await}\n    </div>\n  </Content>\n</Card>\n","<script lang=\"ts\">\n  import type { Version } from '$lib/generated';\n  import Card, { Content } from '@smui/card';\n  import { prettyBytes, prettyDate, prettyNumber } from '$lib/utils/formatting';\n\n  export let version!: Pick<Version, 'created_at' | 'sml_version' | 'size' | 'stability' | 'downloads' | 'hash'>;\n</script>\n\n<Card>\n  <Content>\n    <div class=\"text-lg break-words\">\n      <h3 class=\"text-2xl my-4 font-bold\">Info</h3>\n      <span><strong>Created:</strong> {prettyDate(version.created_at)}</span><br />\n      <span><strong>Downloads:</strong> {prettyNumber(version.downloads)}</span><br />\n      <span><strong>SML Version:</strong> {version.sml_version}</span><br />\n      <span><strong>Stability:</strong> {version.stability}</span><br />\n      <span><strong>Size:</strong> {prettyBytes(version.size)}</span><br />\n      <span><strong>Hash:</strong> {version.hash}</span>\n    </div>\n  </Content>\n</Card>\n","<script lang=\"ts\" context=\"module\">\n  import { paramsToProps } from '$lib/utils/routing';\n  import { operationStore } from '@urql/svelte';\n  import { GetModVersionDocument } from '$lib/generated';\n  import { loadWaitForNoFetch } from '$lib/utils/gql';\n  import MetaDescriptors from '$lib/components/utils/MetaDescriptors.svelte';\n\n  const versionQ = operationStore(GetModVersionDocument, { version: undefined });\n\n  export const load = paramsToProps(async (input) => {\n    versionQ.variables.version = input.params.versionId;\n    return loadWaitForNoFetch({\n      version: versionQ\n    })(input);\n  });\n</script>\n\n<script lang=\"ts\">\n  import { mutation } from '@urql/svelte';\n  import { DeleteVersionDocument } from '$lib/generated';\n  import VersionDescription from '$lib/components/versions/VersionDescription.svelte';\n  import VersionInfo from '$lib/components/versions/VersionInfo.svelte';\n  import { API_REST } from '$lib/core';\n  import Toast from '$lib/components/general/Toast.svelte';\n  import { writable } from 'svelte/store';\n  import { goto } from '$app/navigation';\n  import { user } from '$lib/stores/user';\n  import { base } from '$app/paths';\n  import Button, { Label, Icon } from '@smui/button';\n  import Dialog, { Title, Content as DialogContent } from '@smui/dialog';\n  import { installMod } from '$lib/stores/launcher';\n\n  export let modId!: string;\n  export let versionId!: string;\n  export let version: typeof versionQ;\n\n  let errorMessage = '';\n  let errorToast = false;\n\n  const deleteVersion = mutation({\n    query: DeleteVersionDocument\n  });\n\n  $: canUserEdit =\n    $user?.roles?.deleteContent ||\n    $version?.data?.getVersion.mod?.authors?.findIndex((author) => author.user_id == $user?.id) >= 0;\n\n  const deleteDialogOpen = writable<boolean>(false);\n\n  const deleteVersionFn = () => {\n    deleteVersion({ versionId }).then((value) => {\n      if (value.error) {\n        console.error(value.error.message);\n        errorMessage = 'Error deleting version: ' + value.error.message;\n        errorToast = true;\n      } else {\n        // TODO Toast or something\n        goto(base + '/mod/' + modId);\n      }\n    });\n  };\n</script>\n\n<svelte:head>\n  {#if !$version.fetching && !$version.error && $version.data.getVersion}\n    <MetaDescriptors\n      description=\"Information for mod version {$version.data.getVersion.mod.name} {$version.data.getVersion.version}\"\n      title=\"Mod version {$version.data.getVersion.mod.name} {$version.data.getVersion.version}\"\n    />\n  {/if}\n</svelte:head>\n\n{#if $version.fetching}\n  <p>Loading...</p>\n{:else if $version.error}\n  <p>Oh no... {$version.error.message}</p>\n{:else if $version.data.getVersion}\n  <div class=\"grid gap-6 xlx:grid-flow-row\">\n    <div class=\"flex flex-wrap h-auto justify-between items-center\">\n      <h1 class=\"text-4xl font-bold\">\n        {$version.data.getVersion.mod.name}\n        Version {$version.data.getVersion.version}\n      </h1>\n\n      <div class=\"grid grid-flow-col gap-4\">\n        {#if canUserEdit}\n          <Button variant=\"outlined\" on:click={() => goto(base + '/mod/' + modId + '/version/' + versionId + '/edit')}>\n            Edit\n          </Button>\n          <Button variant=\"outlined\" on:click={() => deleteDialogOpen.set(true)}>Delete</Button>\n        {/if}\n\n        <Button variant=\"outlined\" href={API_REST + '/mod/' + modId + '/versions/' + versionId + '/download'}>\n          Download\n        </Button>\n        <Button variant=\"outlined\" on:click={() => installMod(version.data.getVersion.mod.mod_reference)}>\n          <Label>Install</Label>\n          <Icon class=\"material-icons\">download</Icon>\n        </Button>\n\n        <Button variant=\"outlined\" href={base + '/mod/' + modId}>\n          <Label>Mod</Label>\n          <Icon class=\"material-icons\">extension</Icon>\n        </Button>\n      </div>\n    </div>\n    <div class=\"grid grid-auto-max auto-cols-fr gap-4\">\n      <VersionDescription changelog={$version.data.getVersion.changelog} />\n      <div class=\"grid grid-cols-1 auto-rows-min gap-8\">\n        <VersionInfo version={$version.data.getVersion} />\n      </div>\n    </div>\n  </div>\n\n  {#if canUserEdit}\n    <Dialog bind:open={$deleteDialogOpen}>\n      <Title id=\"simple-title\">Delete Version?</Title>\n      <DialogContent>\n        <div class=\"grid grid-flow-row gap-4\">\n          <span>Are you sure you wish to delete this version</span>\n\n          <Button variant=\"outlined\" on:click={() => deleteDialogOpen.set(false)}>Cancel</Button>\n          <Button variant=\"outlined\" on:click={() => deleteVersionFn()}>Delete</Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  {/if}\n\n  <Toast bind:running={errorToast}>\n    <span>{errorMessage}</span>\n  </Toast>\n{:else}\n  <!-- TODO Better 404 -->\n  404\n{/if}\n"],"names":[],"mappings":"+6CAWkB,gFAAV,2CAAU,0MADJ,GAAS,wKADnB,gGACU,GAAS,0sBANV,8LCQ0B,GAAW,KAAQ,+BACjB,GAAa,KAAQ,+BACnB,KAAQ,kCACV,KAAQ,gCACb,GAAY,KAAQ,iCACpB,KAAQ,+CANF,4CACtB,uEACA,0EACA,8EACA,0EACA,4EACA,qHANsB,iGACtB,oJACA,uJACA,4JACA,uJACA,2JACA,yKAPhB,SACE,qBACA,OAAM,4BAAiE,cACvE,OAAM,4BAAoE,eAC1E,OAAM,6BAA0D,cAChE,OAAM,+BAAsD,cAC5D,OAAM,+BAAyD,gBAC/D,QAAM,wDAL2B,GAAW,KAAQ,qCACjB,GAAa,KAAQ,oCACnB,KAAQ,sCACV,KAAQ,qCACb,GAAY,KAAQ,mCACpB,KAAQ,qpBAZ/B,2OC6DmC,KAAS,KAAK,WAAW,IAAI,SAAO,KAAS,KAAK,WAAW,6BACnF,KAAS,KAAK,WAAW,IAAI,SAAO,KAAS,KAAK,WAAW,sJADvC,KAAS,KAAK,WAAW,IAAI,SAAO,KAAS,KAAK,WAAW,sCACnF,KAAS,KAAK,WAAW,IAAI,SAAO,KAAS,KAAK,WAAW,uIAiE9D,mBAAA,+EApDhB,KAAS,KAAK,WAAW,IAAI,cACrB,KAAS,KAAK,WAAW,uDAI7B,qDAO4B,GAAW,QAAU,KAAQ,aAAe,KAAY,kMAQxD,GAAO,QAAU,0EAOrB,KAAS,KAAK,WAAW,sCAEhC,KAAS,KAAK,oBAKrC,0FAcgB,4BAAA,2GAhDmB;AAAA,0WAAA;AAAA,+sBAHxC,SACE,OACE,mCAKA,sFAsBF,2BAEE,yFA5BG,KAAS,KAAK,WAAW,IAAI,oCACrB,KAAS,KAAK,WAAW,qBAI7B,4HAO4B,GAAW,QAAU,KAAQ,aAAe,KAAY,gJAQxD,GAAO,QAAU,mFAOrB,KAAS,KAAK,WAAW,gDAEhC,KAAS,KAAK,sBAKrC,+LAcgB,8ZArDR,KAAS,MAAM,qCAAzB,yDAAA,2CAAH,2CAAa,KAAS,MAAM,4FAFzB,mDAAA,mCAAH,msBAaoH,oBAAA,6EAGrC,sBAAA,+EAG4B,wBAAA,iFAI5F,uBAAA,gFACsB,wBAAA,2oBAItB,mBAAA,4EACsB,yBAAA,6sBAahB,wBAAA,4MAAA,iJACQ,+BAAA,wFAKmD,sBAAA,+EACV,sBAAA,2TAHxD,kLAAA,6LADR,SACE,+5BAUC,8CAAA,2BAAP,mCAAO,wDAjEH,KAAS,WAAa,KAAS,OAAS,KAAS,KAAK,mEAQzD,MAAS,WAEJ,KAAS,QAET,KAAS,KAAK,4SAZhB,KAAS,WAAa,KAAS,OAAS,KAAS,KAAK,sWAzDtD,IAAW,GAAe,IAAyB,QAAS,SAErD,GAAO,QAAqB,IACvC,IAAS,UAAU,QAAU,EAAM,OAAO,UACnC,IACL,QAAS,KACR,kIAmBM,YACA,gBACA,oBAEP,GAAe,GACf,EAAa,QAEX,GAAgB,IACpB,MAAO,KAOH,EAAmB,GAAkB,6BAErC,QACJ,GAAgB,cAAa,KAAM,IAC7B,EAAM,MACR,SAAQ,MAAM,EAAM,MAAM,aAC1B,EAAe,2BAA6B,EAAM,MAAM,aACxD,EAAa,KAGb,GAAK,GAAO,QAAU,YA6BuB,GAAK,GAAO,QAAU,EAAQ,YAAc,EAAY,eAGxD,EAAiB,IAAI,UAMvB,GAAW,EAAQ,KAAK,WAAW,IAAI,sBA0BrC,EAAiB,IAAI,UACrB,kBAP9B,2BAaA,wKArFlB,EACD,GAAO,OAAO,eACd,GAAU,MAAM,WAAW,KAAK,SAAS,UAAW,GAAW,EAAO,SAAW,GAAO,KAAO"}